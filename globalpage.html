<!DOCTYPE HTML>
<html>
<head>
   <title>global page</title>
   <script type="text/javascript">
 
	function closeWindow() {
		safari.application.activeBrowserWindow.activeTab.close();
	}

	function openTab(event) {
		var url = event.message;
		safari.application.activeBrowserWindow.openTab().url = url;
	}

	function respondToMessage(theMessageEvent) {
		switch (theMessageEvent.name) {
			case "closeWindow":
				closeWindow();
				break;

			case "openTab":
				openTab(theMessageEvent);
				break;

      case "prevTab":
        var index = safari.application.activeBrowserWindow.tabs.indexOf( safari.application.activeBrowserWindow.activeTab );
        if (index == 0) {
          index = safari.application.activeBrowserWindow.tabs.length-1;
        } else {
          index--;
        }
        safari.application.activeBrowserWindow.tabs[index].activate();
        break;

      case "nextTab":
        var index = safari.application.activeBrowserWindow.tabs.indexOf( safari.application.activeBrowserWindow.activeTab );
        if (parseInt(theMessageEvent.message) != 0) {
          if (theMessageEvent.message == "last") {
            index = parseInt(safari.application.activeBrowserWindow.tabs.length)-1;
          } else if (parseInt(theMessageEvent.message) < safari.application.activeBrowserWindow.tabs.length) {
            index = parseInt(theMessageEvent.message)-1;
          }
        } else {
          if (index == parseInt(safari.application.activeBrowserWindow.tabs.length)-1) {
            index = 0;
          } else {
            index++;
          }
        }
        safari.application.activeBrowserWindow.tabs[index].activate();
        break;
		}
	}
 
    safari.application.addEventListener("message",respondToMessage,false);
	
   </script>
</head>
<body> </body>
</html>


